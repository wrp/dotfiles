#!/bin/sh
# Execute this file to load up the tmux paste buffer
# unset TMUX if you really want to just execute it

if test -n "$TMUX"; then
	sed -e '1,/UNI[Q]UE_STRING/d' $0 \
	| if test "$1"; then
		sed -n -E "/^# [.]?$1/,/^-------------- EOF --------------/p"
	else
		cat
	fi \
	| expand \
	| tmux loadb -
	exit
fi
# UNIQUE_STRING

# .bashrc
cat << '-------------- EOF --------------' > $HOME/.bashrc
test -f /etc/bashrc && . /etc/bashrc
unalias -a
trap 'history -a' DEBUG
export EVENT_NOKQUEUE=1
HISTTIMEFORMAT='%H:%M:%S '
HISTFILESIZE=9999999999
export LSCOLORS=fxfxcxdxbxegedabagacad
export LESS=FeRXSQ
export LC_TIME=C
set -o vi
PS1="$(tput setab 4)"'\[$(tput setaf $(( $(expr $? == 0) + 1))
	)\]$(date "+%H:%M:%S") $$ \h\[$( tput setaf 2 2> /dev/null )\]'"$(tput setab 0)\\$ "
PROMPT_COMMAND='printf "\033k%s\033\\" "${HOSTNAME#*-}"'
ta() { tmux attach; }
curl() { command curl -Ss "$@"; }
epoch() { perl -pe 's/([0-9]{9,10})/sprintf "%s (%sUTC)", $1, scalar gmtime $1/ge' "$@"; }
test -z "$COLUMNS" && COLUMNS=$( tput cols 2> /dev/null )
trim() { perl -nE "chomp; say substr \$_, 0, ${COLUMNS-80} - 1"; }

vi() { vim "$@"; }

complete -r gsutil
complete -r gcloud
complete -r bq
-------------- EOF --------------

ln -s .bash_history $HOME/.bash-history


# .bash_profile
cat << '-------------- EOF --------------' > $HOME/.bash_profile
[[ "$-" =~ i ]] && test -f $HOME/.bashrc && . $HOME/.bashrc
-------------- EOF --------------


# .vimrc
cat << '-------------- EOF --------------' > $HOME/.vimrc
nore v V
nore V v
nore ; :
nore , ;
set nowrapscan
let loaded_matchparen = 1
set path+=~
set includeexpr=substitute(v:fname,'$DAEMON_PATH/','','g')
set t_ti= t_te=  " Disable clear screen on exit
set novb
set noeb
set wildmenu
set wildmode=longest,list,full
highlight Comment ctermfg=darkcyan
highlight String ctermfg=darkcyan
-------------- EOF --------------


# .inputrc
cat << '-------------- EOF --------------' > $HOME/.inputrc
set editing-mode vi
set keymap vi
-------------- EOF --------------

# .tmux.conf
cat << 'EOF' > $HOME/.tmux.conf
unbind C-b
set -g prefix C-k
bind C-k send-prefix
set -g window-status-current-bg yellow
set -g window-status-current-fg red
set -g window-status-current-format '#I:#W'
set -g status-left-length 25
set status-right '%H:%M %e-%b'
set-option -g update-environment "SSH_AUTH_SOCK"
set history-limit 25000
bind-key -n Left previous-window
bind-key -n Right next-window
bind-key ',' command-prompt "rename-window '%%'"
bind-key '$' command-prompt "rename-session '%%'"
EOF


# .editrc
cat << '-------------- EOF --------------' > $HOME/.editrc
bind -v
-------------- EOF --------------


# .gitconfig
cat << '-------------- EOF --------------' > $HOME/.gitconfig
[alias]
	ap = add --patch
	b = branch -vv
	cda = commit -a -m Documentation
	cfa = commit -a -m 'Trivial reformat'
	cp = cherry-pick -x
	cra = commit -a -m 'Trivial refactor'
	csa = commit -a -m'Sanity Check'
	cwa = commit -a -m 'Whitespace'
	ciam = commit -a -m
	ci = commit
	caa = !bash -c '"git commit --amend -a -m \"$(git log --format=format:%B -n 1)\" --cleanup=strip"'
	caan = !bash -c '"git commit --amend -an -m \"$(git log --format=format:%B -n 1)\" --cleanup=strip"'
	co = checkout
	dc = diff --cached
	d = diff
	dn = diff --numstat
	dw = diff --word-diff
	l = log --oneline --decorate --format=format:'%Cgreen%h%Cred %<(10,trunc)%an%Cblue%D%Creset %<(80,trunc)%s'
	l1 = log --format=format:'%Cgreen%h%Cred %<(10,trunc)%an%Creset %<(60,trunc)%s %Cblue%D%Creset'
	ld = log --format=format:'%Cgreen%h%C(yellow) %cr %Cred %<(10,trunc)%an%Creset %<(60,trunc)%s %Cblue%D%Creset'
	lt  = log --format=format:'%<(80,trunc)%s %Cblue%D%Creset'
	l1a = log --format=format:'%Cgreen%h%Cred %<(10,trunc)%an%Creset %<(80,trunc)%s %Cblue%d%Creset' --graph
	l1ah = log -n 10 --format=format:'%Cgreen%h%Cblue%d%Creset %<(80,trunc)%s' --graph
	la = log --oneline --graph --decorate --format=format:'%Cgreen%h%Cblue%d%Creset %<(80,trunc)%s'
	lh  = log -n 10 --decorate --format=format:'%Cgreen%h%Cred %<(10,trunc)%an%Creset %<(60,trunc)%s %Cblue%D%Creset' --graph
	l1h = log -n 10 --decorate --format=format:'%Cgreen%h%Cred %<(10,trunc)%an%Creset %<(60,trunc)%s %Cblue%D%Creset' --graph
	s = status -uno
	sp = stash pop
	ss = stash save
	exec = "!exec "
	ll = log --stat
[core]
	excludesfile = ~/.gitignore_global
	editor = vim
[push]
	default = current
[pager]
	status = true
[versionsort]
	prereleaseSuffix = .rc

[color "branch"]
	meta = red green bold
[color]
	branch = true
-------------- EOF --------------
