#!/bin/sh

. "$(dirname $0)"/common-hook-functions

main() {
	check_subject "$@" || die 'bad commit subject'
	run_local_hooks
}


check_subject() {
	bad_end='[.!?]$'  # Characters not allowed at end

	# Abort if the first line of the message is non-conforming
	< "$1" awk '
		NR == 1 && match($0, end) {
			printf "Summary should not match %s. " \
				"(Do not end with punctuation)\n", \
				end > "/dev/stderr"
			exit 1;
		}
		NR == 1 && length > maxlen {
			err = "Summary of commit message is too long"
			err = err " (%d > MAX_GIT_SUMMARY)\n"
			printf err, length > "/dev/stderr"
			exit 1;
		}
	' maxlen=${MAX_GIT_SUMMARY-60} end="$bad_end"
}


main "$@"
