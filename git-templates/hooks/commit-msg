#!/bin/sh

main() {
	check_subject "$@" || return 1
}


check_subject() {
	bad_end='[.!?]$'  # Characters not allowed at end

	# Abort if the first line of the message is non-conforming
	< "$1" awk '
		NR == 1 && match($0, end) {
			printf "Summary cannot match %s. " \
				"(Do not end with punctuation)\n", \
				end > "/dev/stderr"
			exit 1;
		}
		NR == 1 && length > maxlen {
			err = "Summary of commit message is too long"
			err = err " (%d > MAX_GIT_SUMMARY)\n"
			printf err, length > "/dev/stderr"
			exit 1;
		}
	' maxlen=${MAX_GIT_SUMMARY-60} end="$bad_end"
}


if ! main "$@"; then
	echo "commit-msg hook is rejecting this commit" >&2
	exit 1
fi
