#!/bin/sh

. "$(dirname $0)"/common-hook-functions

main() {
	msg=$(check_subject "$@") || die "$msg"
	run_local_hooks
}


check_subject() {
	bad_end='.!?'  # Characters not allowed as final char of subject

	# Abort if the first line of the message is non-conforming
	< "$1" awk '
		NR == 1 && match($0, end) {
			printf "Summary should not " \
				"end with punctuation\n"
			exit 1
		}
		NR == 1 && length > maxlen {
			printf "Summary is too long" \
				" (%d > MAX_GIT_SUMMARY(%d))\n", length, maxlen
			exit 1;
		}
	' maxlen=${MAX_GIT_SUMMARY-60} end="[${bad_end}]$"
}


main "$@"
