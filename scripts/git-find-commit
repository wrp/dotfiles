#!/bin/sh

# Find commits in the main branch (or the branch given in b) which
# contain the given blobs
branch=${b-$(git-base-branch)}


process_blob() {
	test "$1" -eq 00000000 2>/dev/null && return
	git log --format="%at %h ${1:0:8} %s" --find-object="$1" $branch
}

for x; do
	if test -f "$x"; then
		awk '/^index/{print substr($1,7,8)}' FS=. "$x"
	else
		echo "$x"
	fi
done | sort -u |
while read b; do
	process_blob "$b"
done \
| sort -n \
| perl -MTime::Piece -pe 's/^([0-9]{9,10})//; my $t=gmtime($1); print $t->strftime("%Y-%m-%d@%T")'
