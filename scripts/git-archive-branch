#!/bin/sh

# Archive branches by creating a ref in refs/archive
# and deleting the branch.  If no arguments are given,
# archive the current branch after detaching

current_branch=$(git rev-parse --abbrev-ref HEAD)
if test $# = 0; then
	set -- "$current_branch"
fi

for branch; do
	if test "$branch" = "$current_branch"; then
		echo "Detaching and archiving the current branch: $branch"
		git checkout --detach || exit
	fi

	archive_name=refs/archive/"${branch}"
	extant_ref=$(git show-ref -s "$archive_name" || true)

	git update-ref "$archive_name" "${branch}" "$extant_ref" || exit
	git branch -D "${branch}" || exit
done

