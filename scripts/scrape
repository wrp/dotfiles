#!/bin/sh

# scrape a tmux pane.  By default, this scrapes the current
# pane, skipping the bottom few lines (the lines used to
# invoke the script)

# for capture pane, zero is the first line of visible pane,
# positive numbers go down the pane, negative numbers are
# scrolled off top

if test $# = 0; then
	end=$(( $(tmux display-message -pt "$target" -F '#{pane_height}') - 3))
	start=-1 # After user hits return, the current top of pane will scroll up to -1
	target=$TMUX_PANE
else
	adjust=$((${3-0}))
	case $1 in
	.    ) target=$TMUX_PANE; : $((adjust += 2)) ;;
	[0-9]) target=$1.0 ;;
	*    ) target=$1 ;;
	esac

	if test "${2-0}" -ne 0; then
		end=$(( $(tmux display-message -pt "$target" -F '#{pane_height}') - $adjust - 1))
		start=$((end - $2 + 1))
	else
		start=-
		end=-
	fi
fi

tmux capture-pane -p -E "$end" -S "$start" -t "$target"
