#!/bin/sh


branch=${1-$(git base-branch)} || exit
current=$(git rev-parse --abbrev-ref HEAD)

if test "$current" = "$branch"; then
	git pull --quiet
	exit
fi

remote=$(git config branch.${branch}.remote)
upstream=$(git rev-parse --abbrev-ref --symbolic-full-name ${branch}@{u})
if test -z "$remote" || test -z "$upstream"; then
	echo "Can't find remote for $branch" >&2
	exit 1
fi
git fetch --quiet "$remote" || exit 1
old=$(git show-ref refs/heads/$branch)
new=$(git show-ref $upstream)

if test "${old% *}" = "${new% *}"; then
	echo No changes
else
	echo "Updating: $old"
	echo "  -->     $new"
	git update-ref refs/heads/$branch $upstream || exit 1
fi
